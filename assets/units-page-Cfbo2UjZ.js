import{u as R,d as m,f as u,o as a,i as p,c as _,a as r,m as S,w as h,g,j as T,t as v,b as y,e as B,r as k,k as F,l as U,F as $,h as N,n as z,R as D,s as I,p as L,q as P,v as V,x as A}from"./index-C9CaaGqW.js";import{P as M,c as j}from"./css-CJd3TykV.js";import{c as x,a as E}from"./createLucideIcon-B-AVHsDY.js";import{_ as q,a as H,b as G,c as O}from"./card-title.vue_vue_type_script_setup_true_lang-Bq9NjXQX.js";function Q(s,t={}){return R(`/sections/${s}/units`,t).json()}const W={viewBox:"0 0 120 120"},J=["stroke-dashoffset"],K=m({__name:"donut-chart",props:{percentage:{},stroke:{}},setup(s){return(t,e)=>(a(),u("svg",W,[p("circle",{cx:"60",cy:"60",r:"50","stroke-width":"8",fill:"none","stroke-dasharray":"314","stroke-dashoffset":314*(1-t.percentage/100),"stroke-linecap":"round",transform:"rotate(-90 60 60)"},null,8,J)]))}});/**
 * @license lucide-vue-next v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=x("book-text",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}],["path",{d:"M8 11h8",key:"vwpz6n"}],["path",{d:"M8 7h6",key:"1f0q6e"}]]);/**
 * @license lucide-vue-next v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=x("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-vue-next v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=x("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]),Z=m({__name:"lesson-btn",props:{asChild:{type:Boolean},as:{default:"button"},status:{},class:{}},setup(s){const t=s,e={completed:Y,unreached:C,active:C},o=E("relative w-17 h-17 flex items-center justify-center rounded-full z-3",{variants:{status:{active:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90 [&_svg]:fill-primary-foreground",unreached:"bg-gray-200 text-gray-800 shadow-xs hover:bg-gray-300 [&_svg]:fill-gray-800",completed:"bg-gray-200 text-gray-800 shadow-xs hover:bg-gray-300"}}});return(i,c)=>(a(),_(r(M),S(t,{"as-child":t.asChild,as:t.as,class:r(j)(r(o)({status:t.status}),t.class)}),{default:h(()=>[(a(),_(T(e[t.status]),{class:"w-8 h-8 stroke-3"})),t.status==="active"?(a(),_(K,{key:0,percentage:50,class:"absolute w-24 h-24 -z-1 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 [&_circle]:stroke-slate-700",stroke:"red-700"})):g("",!0)]),_:1},16,["as-child","as","class"]))}}),tt={class:"w-full flex items-center gap-2 mb-8"},et={class:"font-bold text-gray-400 text-xl"},st=m({__name:"list-header",props:{title:{}},setup(s){return(t,e)=>(a(),u("h2",tt,[e[0]||(e[0]=p("div",{class:"h-0.5 flex-grow bg-gray-200"},null,-1)),p("span",et,v(t.title),1),e[1]||(e[1]=p("div",{class:"h-0.5 flex-grow bg-gray-200"},null,-1))]))}}),rt={class:"font-bold text-lg text-gray-800"},at={class:"flex items-center justify-center w-16 h-full"},nt=m({__name:"unit-desc-card",props:{title:{},subtitle:{}},setup(s){const t=s;return(e,o)=>(a(),_(r(q),{class:"relative z-80 flex-row gap-0 py-0"},{default:h(()=>[y(r(H),{class:"gap-0 flex-grow p-4"},{default:h(()=>[y(r(G),{class:"uppercase font-semibold text-gray-600"},{default:h(()=>[B(v(t.title),1)]),_:1}),p("p",rt,v(t.subtitle),1)]),_:1}),y(r(O),{class:"flex items-center p-0 border-l-2 border-gray-200"},{default:h(()=>[p("button",at,[y(r(X),{class:"w-8 h-8 stroke-gray-800"})])]),_:1})]),_:1}))}});function ot(s){const t=k([]),e=k({unitTitle:s.value?.[0].title??"",unitNumber:s.value?.[0].number??0});F(t,c=>{const n=c.find(f=>f.isIntersecting);if(!n)return;const l=i(n.target);l&&o(l)},{threshold:.7});function o(c){const n=s.value?.find(l=>l.number===c)?.title;n&&(e.value={unitTitle:n,unitNumber:c})}function i(c){const n=c.getAttribute("data-unit");return n?parseInt(n):null}return{targetRefs:t,desc:e}}const ct={key:0},it={key:1},lt=["data-unit"],ut={class:"flex flex-col items-center gap-6"},ft=m({__name:"units-list",props:{sectionNumber:{},data:{},isFetching:{type:Boolean},error:{}},setup(s,{expose:t}){const e=s,{data:o}=U(e),i=k(null);t({root:i});const{targetRefs:c,desc:n}=ot(o);return(l,f)=>(a(),u("div",{class:"flex flex-col items-center gap-8",ref_key:"root",ref:i},[l.isFetching?(a(),u("p",ct,"Loading...")):g("",!0),l.error?(a(),u("p",it,"An error occurred")):g("",!0),r(o)?.length&&r(n).unitTitle?(a(),_(nt,{key:2,title:`Section ${l.sectionNumber}, Unit ${r(n).unitNumber}`,subtitle:r(n).unitTitle,class:"fixed top-5 left-4 right-4"},null,8,["title","subtitle"])):g("",!0),(a(!0),u($,null,N(r(o),(d,w)=>(a(),u("div",{class:z(`w-full ${w===0?"pt-26":""}`),key:d.number,"data-unit":d.number,ref_for:!0,ref_key:"targetRefs",ref:c},[w!==0?(a(),_(st,{key:0,title:d.title},null,8,["title"])):g("",!0),p("div",ut,[(a(!0),u($,null,N(d.lessons,b=>(a(),_(Z,{as:r(D),status:b.status,to:`/sections/${d.sectionNumber}/units/${d.number}/lessons/${b.number}/variants/${b.currentVariant}`,key:b.number},null,8,["as","status","to"]))),128))])],10,lt))),128))],512))}});function dt(s,t){const e=I();L(s,async()=>{await o()});async function o(){if(!s.value?.length||!e.value?.root)return;await P();const i=e.value.root;pt(i,t)}return{listRef:e}}function pt(s,t){const e=s.querySelector(`[data-unit="${t}"]`);e&&e.scrollIntoView({block:"start"})}const _t={class:"relative"},bt=m({__name:"units-page",setup(s){const t=V(),e=parseInt(t.params.sectionNumber),o=A(),{data:i,isFetching:c,error:n}=Q(e,{afterFetch({data:f}){return f?{data:o.convertUnitToUnitWithProgress(f)}:{data:f}}}),{listRef:l}=dt(i,o.progress.lesson.unit);return(f,d)=>(a(),u("div",_t,[y(r(ft),{ref_key:"listRef",ref:l,sectionNumber:r(e),data:r(i),"is-fetching":r(c),error:r(n)},null,8,["sectionNumber","data","is-fetching","error"])]))}});export{bt as default};
